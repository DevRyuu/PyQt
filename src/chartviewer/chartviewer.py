import os
import numpy as np

from PySide6.QtWidgets import QWidget, QGridLayout
from PySide6.QtWebEngineWidgets import QWebEngineView

import plotly.express as px
import plotly.graph_objects as go

wavelength = [395.94, 397.96, 399.97, 401.98, 404.0, 406.02, 408.04, 410.07, 412.1, 414.12, 416.14, 418.16, 420.19, 422.22, 424.24, 426.28, 428.3, 430.33, 432.36, 434.4, 436.43, 438.46, 440.5, 442.53, 444.56, 446.6, 448.64, 450.68, 452.72, 454.76, 456.8, 458.84, 460.88, 462.92, 464.97, 467.02, 469.06, 471.1, 473.16, 475.2, 477.25, 479.3, 481.35, 483.4, 485.46, 487.51, 489.56, 491.62, 493.68, 495.73, 497.78, 499.84, 501.9, 503.96, 506.02, 508.08, 510.14, 512.22, 514.28, 516.34, 518.4, 520.48, 522.54, 524.6, 526.67, 528.74, 530.82, 532.89, 534.96, 537.03, 539.11, 541.18, 543.26, 545.33, 547.41, 549.49, 551.57, 553.65, 555.73, 557.81, 559.89, 561.98, 564.06, 566.14, 568.23, 570.32, 572.4, 574.49, 576.58, 578.67, 580.76, 582.85, 584.94, 587.04, 589.12, 591.22, 593.32, 595.42, 597.52, 599.61, 601.7, 603.81, 605.9, 608.0, 610.12, 612.22, 614.32, 616.42, 618.52, 620.64, 622.74, 624.85, 626.95, 629.07, 631.18, 633.29, 635.4, 637.51, 639.63, 641.74, 643.86, 645.97, 648.09, 650.21, 652.33, 654.45, 656.57, 658.69, 660.81, 662.93, 665.06, 667.18, 669.3, 671.43, 673.56, 675.68, 677.82, 679.94, 682.08, 684.2, 686.34, 688.47, 690.6, 692.74, 694.88, 697.0, 699.14, 701.29, 703.42, 705.56, 707.7, 709.84, 711.98, 714.12, 716.26, 718.42, 720.56, 722.7, 724.85, 727.0, 729.14, 731.3, 733.44, 735.6, 737.75, 739.9, 742.06, 744.21, 746.36, 748.52, 750.68, 752.83, 754.99, 757.15, 759.31, 761.47, 763.63, 765.8, 767.96, 770.12, 772.29, 774.46, 776.62, 778.79, 780.96, 783.12, 785.3, 787.46, 789.64, 791.81, 793.98, 796.16, 798.34, 800.5, 802.68, 804.86, 807.04, 809.21, 811.4, 813.58, 815.76, 817.94, 820.12, 822.31, 824.5, 826.68, 828.86, 831.06, 833.24, 835.44, 837.62, 839.82, 842.0, 844.2, 846.39, 848.58, 850.78, 852.97, 855.17, 857.37, 859.57, 861.76, 863.96, 866.16, 868.37, 870.57, 872.77, 874.97, 877.18, 879.38, 881.59, 883.8, 886.01, 888.21, 890.42, 892.64, 894.84, 897.06, 899.28, 901.48, 903.7, 905.92, 908.14, 910.35, 912.56, 914.79, 917.0, 919.22, 921.44, 923.67, 925.9, 928.12, 930.34, 932.56, 934.8, 937.02, 939.25, 941.47, 943.7, 945.94, 948.17, 950.4, 952.63, 954.86, 957.1, 959.34, 961.57, 963.81, 966.05, 968.29, 970.53, 972.77, 975.01, 977.25, 979.49, 981.73, 983.98, 986.22, 988.47, 990.72, 992.96, 995.21, 997.46, 999.71, 1001.96, 1004.21, 1006.47, 1008.72, 1010.97, 1013.23, 1015.48, 1017.74, 1020.01, 1022.27, 1024.53, 1026.78, 1029.04, 1031.3, 1033.56, 1035.83]

y_values = [0.039603960396039604, 0.040983606557377046, 0.033783783783783786, 0.03389830508474576, 0.03317535545023697, 0.027777777777777776, 0.02666666666666667, 0.025280898876404494, 0.02403846153846154, 0.023060796645702306, 0.022429906542056073, 0.021922428330522766, 0.02157164869029276, 0.021337126600284494, 0.021136063408190225, 0.022085889570552148, 0.022962112514351322, 0.02446808510638298, 0.025540275049115914, 0.026102610261026102, 0.028169014084507043, 0.02968036529680365, 0.03268428372739916, 0.0347661188369153, 0.03669724770642202, 0.03908285565398645, 0.0405727923627685, 0.04209127159946832, 0.04227710339053997, 0.042071197411003236, 0.041550139832201356, 0.0404, 0.03909713825070536, 0.037959183673469385, 0.036378668871434476, 0.03494176372712146, 0.03419516263552961, 0.0329441201000834, 0.03177257525083612, 0.03096234309623431, 0.030378693300041615, 0.030065897858319604, 0.029698942229454843, 0.02967121090617482, 0.0298390263054574, 0.030164184803360063, 0.030471943515421776, 0.030752532561505064, 0.03161222339304531, 0.03236797274275979, 0.03341051935163745, 0.03470437017994859, 0.03587024329382408, 0.03767851716803403, 0.03968964488212474, 0.042328042328042326, 0.045204288611996525, 0.048696648524778, 0.052571753339016765, 0.05736083639446171, 0.062151616499442584, 0.06761957119296316, 0.0730581205866377, 0.07810395906275248, 0.08317781924820047, 0.08779330345373056, 0.09162303664921466, 0.09528768549856809, 0.09762396694214875, 0.09956488354235987, 0.10144927536231885, 0.102803738317757, 0.10398396391881734, 0.10510659395141299, 0.10550795593635251, 0.10606796116504855, 0.1061411992263056, 0.10544053923928744, 0.1050986050986051, 0.10412147505422993, 0.10244020294757188, 0.10055730554882482, 0.09808205875212431, 0.0948905109489051, 0.09168704156479218, 0.08827856792545366, 0.08472495088408645, 0.08136094674556213, 0.0782565626547796, 0.07573876334740502, 0.07329192546583851, 0.0708955223880597, 0.06921539230384807, 0.06726907630522089, 0.0658953722334004, 0.06454866364094806, 0.06333924499619964, 0.062420382165605096, 0.06160531697341513, 0.06061381074168798, 0.05975891254167735, 0.058444902162718845, 0.057061709269300286, 0.05567063697566028, 0.053927923256416904, 0.05223492723492724, 0.05032594524119948, 0.048581932773109245, 0.04706195160861473, 0.04568802379021357, 0.044444444444444446, 0.04356270810210877, 0.04300168634064081, 0.04247434435575827, 0.041582442968524404, 0.04088785046728972, 0.03965670316661734, 0.03849624060150376, 0.03692401586817211, 0.035471930906847624, 0.03405185879412684, 0.03230915426037377, 0.03075937199615508, 0.029744584545748465, 0.028683181225554105, 0.027731924727632883, 0.02671118530884808, 0.02561509942703067, 0.024514811031664963, 0.023464458247066944, 0.023060796645702306, 0.022198731501057084, 0.02199361475700603, 0.021451555237754737, 0.021253602305475506, 0.02168413444163354, 0.021715526601520086, 0.022141560798548093, 0.02259475218658892, 0.02347762289068232, 0.024851632047477746, 0.027777777777777776, 0.031594975256947086, 0.03786707882534776, 0.04483430799220273, 0.05358550039401103, 0.06314948041566747, 0.07327935222672065, 0.08394758394758395, 0.09425382389417114, 0.10414052697616061, 0.11450381679389313, 0.1244101244101244, 0.1339712918660287, 0.14450354609929078, 0.15648684797146678, 0.16542014958205015, 0.17060367454068243, 0.17628911414720141, 0.18299776286353467, 0.18982742960944596, 0.19696969696969696, 0.20306691449814127, 0.20819594912859163, 0.21295855169128156, 0.21737044145873322, 0.22082931533269046, 0.22416302765647744, 0.22687439143135346, 0.22882181110029212, 0.2302439024390244, 0.23122238586156113, 0.23202776400594943, 0.22789287518948964, 0.2283008942661757, 0.2291554599246907, 0.2314410480349345, 0.23355263157894737, 0.23370165745856353, 0.23460246360582307, 0.23462414578587698, 0.2361111111111111, 0.23616018845700826, 0.23628691983122363, 0.23656578134651018, 0.2368919772583702, 0.23689320388349513, 0.2372093023255814, 0.2373806275579809, 0.23812849162011174, 0.23806129722024233, 0.23781818181818182, 0.2384843982169391, 0.2376987130961393, 0.23846153846153847, 0.23828125, 0.23805732484076433, 0.23697068403908794, 0.23558897243107768, 0.235597592433362, 0.23519009725906279, 0.23710407239819004, 0.2356746765249538, 0.23701605288007555, 0.23704414587332054, 0.2372549019607843, 0.23728813559322035, 0.23785425101214575, 0.23897435897435898, 0.24116424116424118, 0.24054621848739496, 0.24097664543524416, 0.24163969795037757, 0.2414928649835346, 0.24076147816349383, 0.2408256880733945, 0.24061032863849766, 0.24033816425120774, 0.242274412855377, 0.24146649810366624, 0.24124513618677043, 0.2416555407209613, 0.2407152682255846, 0.24220963172804533, 0.24273255813953487, 0.24287856071964017, 0.2426584234930448, 0.24285714285714285, 0.24143556280587275, 0.2411467116357504, 0.24083769633507854, 0.2423146473779385, 0.24299065420560748, 0.24177949709864605, 0.24048096192384769, 0.2390852390852391, 0.23758099352051837, 0.23820224719101124, 0.2372093023255814, 0.2403846153846154, 0.2400990099009901, 0.23711340206185566, 0.23796791443850268, 0.2388888888888889, 0.23563218390804597, 0.23809523809523808, 0.23765432098765432, 0.23809523809523808, 0.24013157894736842, 0.23809523809523808, 0.23674911660777384, 0.23333333333333334, 0.22957198443579765, 0.23265306122448978, 0.23076923076923078, 0.23008849557522124, 0.22935779816513763, 0.22857142857142856, 0.22772277227722773, 0.22564102564102564, 0.22872340425531915, 0.22527472527472528, 0.22727272727272727, 0.22485207100591717, 0.2222222222222222, 0.22580645161290322, 0.22297297297297297, 0.2198581560283688, 0.22388059701492538, 0.2248062015503876, 0.21951219512195122, 0.21551724137931033, 0.21818181818181817, 0.21904761904761905, 0.22, 0.22105263157894736, 0.21978021978021978, 0.21839080459770116, 0.2289156626506024, 0.22784810126582278, 0.2236842105263158, 0.2222222222222222, 0.22058823529411764, 0.2153846153846154, 0.21311475409836064, 0.20689655172413793, 0.21818181818181817, 0.21153846153846154, 0.20408163265306123, 0.21739130434782608, 0.20454545454545456, 0.21951219512195122, 0.20512820512820512, 0.21621621621621623, 0.2, 0.21875, 0.1935483870967742, 0.1724137931034483, 0.18518518518518517, 0.2]

class ChartViewer(QWidget):
    def __init__(self, ui):
        super(ChartViewer, self).__init__()
        self.view = ui.frame_chart
        self.gridLayout = QGridLayout(self.view)
        self.gridLayout.setContentsMargins(0, 0, 0, 0)
        self.browser = QWebEngineView(self)
        self.gridLayout.addWidget(self.browser, 0, 0, 1, 1)

    def show_graph(self):
        fig = go.Figure()

        title = "타이틀"
        xlabel = "x축 레이블"
        ylabel = "y축 레이블"

        fig.update_layout(
            title_text=title,
            title_x = 0.5,
            title_y = 0.95,
            title_xanchor = "center",
            title_yanchor = "middle",
            title_font_size = 25,
            title_font_color = "red",
            title_font_family = "Times")
        fig.update_xaxes(title=xlabel)
        fig.update_yaxes(title=ylabel)

        y_min = min(y_values)
        y_max = max(y_values)
        y_mid = (0 + y_min) / 2
        y_range = [y_mid, y_max * 1.2]
        fig.update_yaxes(range=y_range)

        # 데이터 추가
        fig.add_trace(go.Scatter(x=wavelength, y=y_values,
                                 mode='lines+markers',
                                 name='lines+markers'))

        # 화면 출력
        self.browser.setHtml(fig.to_html(include_plotlyjs='cdn'))